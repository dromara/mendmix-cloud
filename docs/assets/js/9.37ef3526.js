(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{823:function(t,a,s){"use strict";s.r(a);var e=s(111),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("h2",{attrs:{id:"为什么要造轮子"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为什么要造轮子"}},[t._v("#")]),t._v(" 为什么要造轮子？")]),t._v(" "),s("p",[t._v("之前试用过几个开源的配置中心(disconf、Apollo、diamond以及Spring Cloud Config)，各有弊端或者是不满足我们的需求(譬如部署复杂、功能太复杂、不支持全局配置、不支持敏感配置加密，对springboot支持不友好,界面不友好或者无界面等等)。所以从2016年开始有了一个初级版本，经过三年生产环境实际需求不断完善于是就有了这个开源项目。")]),t._v(" "),s("h2",{attrs:{id:"主要功能清单"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主要功能清单"}},[t._v("#")]),t._v(" 主要功能清单")]),t._v(" "),s("ol",[s("li",[t._v("支持多环境、多版本配置管理")]),t._v(" "),s("li",[t._v("支持全局配置")]),t._v(" "),s("li",[t._v("支持配置文件(properties,yaml,xml)、配置项、json配置支持")]),t._v(" "),s("li",[t._v("支持加密配置(server自动加密，client自动解密)")]),t._v(" "),s("li",[t._v("支持spring、springboot无缝对接")]),t._v(" "),s("li",[t._v("支持环境+项目维度精细化权限(只读/读写)控制")]),t._v(" "),s("li",[t._v("支持http和zookeeper方式配置实时同步")]),t._v(" "),s("li",[t._v("支持查看配置历史版本、一键回滚、版本对比")]),t._v(" "),s("li",[t._v("安全功能支持:可选开启安全ip功能与内网拉取配置限制")]),t._v(" "),s("li",[t._v("多业务组/部门数据隔离")]),t._v(" "),s("li",[t._v("支持集群部署")])]),t._v(" "),s("h2",{attrs:{id:"特点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[t._v("#")]),t._v(" 特点")]),t._v(" "),s("ul",[s("li",[t._v("轻量级：无需任何中间件(http方式下发同步)即可运行")]),t._v(" "),s("li",[t._v("代码简单：二开成本低")]),t._v(" "),s("li",[t._v("安全性高：除了配置加密功能外，还提供多种拉取配置安全策略")])]),t._v(" "),s("h1",{attrs:{id:"服务端部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务端部署"}},[t._v("#")]),t._v(" 服务端部署")]),t._v(" "),s("h3",{attrs:{id:"下载项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#下载项目"}},[t._v("#")]),t._v(" 下载项目")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("git clone https://gitee.com/vakinge/jeesuite-config.git\n")])])]),s("h2",{attrs:{id:"编译项目"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编译项目"}},[t._v("#")]),t._v(" 编译项目")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mvn clean package -DskipTests=true\n")])])]),s("p",[s("strong",[t._v("最终生成部署包为")]),t._v("：jeesuite-config-server/target/jeesuite-config-server.jar")]),t._v(" "),s("h2",{attrs:{id:"创建数据库表"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建数据库表"}},[t._v("#")]),t._v(" 创建数据库表")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("CREATE DATABASE IF NOT EXISTS `configcenter` DEFAULT CHARSET utf8 COLLATE utf8_general_ci;\n")])])]),s("blockquote",[s("p",[t._v("执行sql目录下数据库脚本: init.sql 与 testdata.sql (此为测试数据，可选)")])]),t._v(" "),s("h2",{attrs:{id:"关键配置说明-启动前请自行修改各个环境的配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#关键配置说明-启动前请自行修改各个环境的配置"}},[t._v("#")]),t._v(" 关键配置说明（启动前请自行修改各个环境的配置）")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#数据库配置\ndb_host=127.0.0.1\n#数据名\ndb_name=configcenter\ndb_username=root\ndb_password=123456\n\n#是否允许外网拉取配置（白名单机制生效）\napi.extranet.enabled=true\n#敏感配置是否强制加密\nsensitive.config.force.encrypt=false\n\n#开启自动缓存（依赖redis）\njeesuite.mybatis.cacheEnabled=true\njeesuite.cache.mode=standalone\njeesuite.cache.servers=127.0.0.1:6379\njeesuite.cache.password=123456\njeesuite.cache.database=0\n\n#开启共享session（集群部署必须）\nsecurity.cache.storage-type=redis\nsecurity.cache.servers=127.0.0.1:6379\nsecurity.cache.password=123456\nsecurity.cache.database=1\n")])])]),s("h2",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动"}},[t._v("#")]),t._v(" 启动")]),t._v(" "),s("p",[t._v("拷贝"),s("strong",[t._v("jeesuite-config-server.jar")]),t._v(" 与 "),s("strong",[t._v("application.properties")]),t._v(" 在同一目录，springboot会优先加载同一目录下名为_application.properties的配置文件。")]),t._v(" "),s("p",[t._v("启动命令")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("java -jar jeesuite-config-server.jar\n# 或 （适合linux或mac 后台运行）\nnohup java -jar jeesuite-config-server.jar > config-server.out 2>&1 &\n")])])]),s("p",[t._v("本地访问："),s("code",[t._v("http://127.0.0.1:8180")]),t._v(" ,账号密码：admin/admin123")]),t._v(" "),s("h2",{attrs:{id:"操作指引"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#操作指引"}},[t._v("#")]),t._v(" 操作指引")]),t._v(" "),s("ul",[s("li",[t._v("业务组管理：如果需要分多个业务组，各个组需要隔离，请先"),s("code",[t._v("添加业务组")]),t._v(";")]),t._v(" "),s("li",[t._v("用户管理：添加用户，可以指定业务组，默认密码为手机号后八位；")]),t._v(" "),s("li",[t._v("profile(环境)管理：可以为每个环境配置配置"),s("code",[t._v("同步的zookeeper")]),t._v("以及拉取配置"),s("code",[t._v("IP白名单")])]),t._v(" "),s("li",[t._v("应用管理：添加应用,会自动生成对应每个环境的token")]),t._v(" "),s("li",[t._v("配置管理：配置分全局配置与应用配置，支持配置文件、key-value配置、json配置")])]),t._v(" "),s("hr"),t._v(" "),s("h1",{attrs:{id:"应用集成-客户端"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用集成-客户端"}},[t._v("#")]),t._v(" 应用集成（客户端）")]),t._v(" "),s("h2",{attrs:{id:"添加依赖"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[t._v("#")]),t._v(" 添加依赖")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("<dependency>\n  <groupId>com.jeesuite</groupId>\n  <artifactId>jeesuite-config-client</artifactId>\n <version>[版本号]</version>\n</dependency>\n")])])]),s("h2",{attrs:{id:"添加配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加配置"}},[t._v("#")]),t._v(" 添加配置")]),t._v(" "),s("p",[t._v("在项目增加如下配置：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("#是否启用配置中心，默认：true\njeesuite.configcenter.enabled=false\n#应用名：对应server端的应用配置\njeesuite.configcenter.appName=account\njeesuite.configcenter.base.url=http://configserver:8080\n#当前环境\njeesuite.configcenter.profile=dev\n#拉取配置版本，默认:latest\njeesuite.configcenter.version=latest\n#是否忽略全局配置,默认：false\njeesuite.configcenter.global-ignore=false\n#拉取配置认证的token\njeesuite.configcenter.token=\n#同步方式，默认:http\njeesuite.configcenter.sync-type=zookeeper\n# 同步间隔，同步方式为：http时生效\njeesuite.configcenter.sync-interval-seconds=30\n")])])]),s("blockquote",[s("p",[t._v("通过JVM参数外部设置配置方式")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("-Djeesuite.configcenter.profile=dev\n")])])]),s("blockquote",[s("p",[t._v("docker外部设置配置方式")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('-e jeesuite.configcenter.profile="dev"\n')])])]),s("blockquote",[s("p",[t._v("springboot项目增加以上配置即可，spring项目还需要做如下修改：")])]),t._v(" "),s("ol",[s("li",[t._v("去掉原加载配置相关配置")]),t._v(" "),s("li",[t._v("新增配置")])]),t._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("bean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("com.jeesuite.confcenter.spring.CCPropertyPlaceholderConfigurer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("remoteEnabled"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("value")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("true"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 本地配置文件，无本地配置可不配置 --\x3e")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("property")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("locations"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("classpath*:application.properties"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("list")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("property")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("bean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),s("h2",{attrs:{id:"一些用法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#一些用法"}},[t._v("#")]),t._v(" 一些用法")]),t._v(" "),s("h3",{attrs:{id:"配置优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置优先级"}},[t._v("#")]),t._v(" 配置优先级")]),t._v(" "),s("ol",[s("li",[t._v("应用本地配置 > 远程应用配置 > 远程全局配置")]),t._v(" "),s("li",[t._v("配置中心配置"),s("code",[t._v("jeesuite.configcenter.remote-config-first=true")]),t._v("可以启用远程配置覆盖本地配置")])]),t._v(" "),s("h3",{attrs:{id:"配置实时生效"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置实时生效"}},[t._v("#")]),t._v(" 配置实时生效")]),t._v(" "),s("p",[t._v("配置变更后会实时下发到应用，可以通过以下方式实时读取最新配置")]),t._v(" "),s("ol",[s("li",[t._v("在代码中使用"),s("code",[t._v("ResourceUtils")]),t._v("实时读取")]),t._v(" "),s("li",[t._v("依赖注入"),s("code",[t._v("Environment")]),t._v("，在代码中实时读取")]),t._v(" "),s("li",[t._v("实现"),s("code",[t._v("ConfigChangeHanlder")]),t._v("接口，自定义刷新逻辑")])]),t._v(" "),s("hr"),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Controller")]),t._v("  \n"),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@RequestMapping")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/sms"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AuthCommonController")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ConfigChangeHanlder")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Value")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"${sms.send.open}"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n    "),s("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Override")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("onConfigChanged")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Map")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" changedConfigs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("changedConfigs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("containsKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sms.send.open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("open")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Boolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseBoolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("changedConfigs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"sms.send.open"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h3",{attrs:{id:"配置忽略"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置忽略"}},[t._v("#")]),t._v(" 配置忽略")]),t._v(" "),s("p",[t._v("正常情况应用的配置为全局配置与应用自身配置合并的结果，如果不需要某些全局配置项目如下配置即可")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("db.maxActive=[Ignore]\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);